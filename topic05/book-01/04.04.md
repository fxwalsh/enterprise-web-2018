# Add Passport Authentication

Passport strategies are a middleware functions that a requests runs through before getting to the actual route.​ You will now create a JWT strategy and add it to the /api/posts route.

+ in the root folder create a new folder called **auth**.
+ Create a new file called **/auth/index.js** with the following contents:

~~~javascript
import passport from 'passport';
import passportJWT from 'passport-jwt';
import UserModel from './../api/users/userModel';
import dotenv from 'dotenv';

dotenv.config();

const JWTStrategy = passportJWT.Strategy;
const ExtractJWT = passportJWT.ExtractJwt;

let jwtOptions = {};
jwtOptions.jwtFromRequest = ExtractJWT.fromAuthHeaderAsBearerToken();
jwtOptions.secretOrKey = process.env.secret;
const strategy = new JWTStrategy(jwtOptions, async function(payload, next) {
  console.log('payload received', payload);
  // usually this would be a database call:
  const user = await UserModel.find({username: payload});
  if (user) {
    next(null, user);
  } else {
    next(null, false);
  }
});

passport.use(strategy);

export default passport;
~~~

You need to import the jwt configured passport object into the main app script,  */index.js*.

+ Open **/index.js** and make the following changes to add authentication to the /api/posts/ route:

~~~javascript
// import passport configured with JWT strategy​
import passport from './auth';​

…​

// initialise passport​
app.use(passport.initialize());​

…​

// Add passport.authenticate(..)  to middleware stack for protected routes​
app.use('/api/posts', passport.authenticate('jwt', {session: false}), postsRouter);

~~~

##
